spring:
  application:
    name: janusleaf
  config:
    import: optional:file:./secrets.properties

  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/janusleaf}
    username: ${DATABASE_USERNAME:janusleaf}
    password: ${DATABASE_PASSWORD:janusleaf}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: '0'

  jackson:
    serialization:
      write-dates-as-timestamps: false
    default-property-inclusion: non_null

server:
  port: ${SERVER_PORT:8080}

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:your-256-bit-secret-key-here-change-in-production-min-32-chars}
  access-token-expiration: ${JWT_ACCESS_EXPIRATION:900000}      # 15 minutes in ms
  refresh-token-expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 7 days in ms

# OpenRouter Configuration (for AI mood analysis)
openrouter:
  api-key: ${OPENROUTER_API_KEY:}
  base-url: ${OPENROUTER_BASE_URL:https://openrouter.ai/api/v1}
  model: ${OPENROUTER_MODEL:google/gemma-3-27b-it:free}
  # Debounce delay in milliseconds - wait this long after last edit before analyzing
  debounce-delay-ms: ${MOOD_DEBOUNCE_DELAY:5000}
  # Rate limiting configuration
  request-delay-ms: ${OPENROUTER_REQUEST_DELAY:2000}
  rate-limit-backoff-base-ms: ${OPENROUTER_BACKOFF_BASE:10000}
  max-retries: ${OPENROUTER_MAX_RETRIES:5}
  # Fallback API (ChatAnywhere - OpenAI compatible)
  # See: https://github.com/chatanywhere/GPT_API_free
  fallback:
    enabled: ${FALLBACK_API_ENABLED:false}
    api-key: ${FALLBACK_API_KEY:}
    base-url: ${FALLBACK_API_BASE_URL:https://api.chatanywhere.org/v1}
    model: ${FALLBACK_API_MODEL:gpt-4o-mini}

# Scheduled Jobs Configuration
jobs:
  mood-analysis:
    # Cron expression for mood analysis queue polling
    # Format: second minute hour day-of-month month day-of-week
    cron: ${MOOD_ANALYSIS_CRON:*/3 * * * * *}
  inspirational-quote:
    # Cron expression for inspirational quote generation
    # Runs every 30 seconds to check for quotes needing generation/regeneration
    cron: ${INSPIRATIONAL_QUOTE_CRON:*/30 * * * * *}

# Logging
logging:
  level:
    com.janusleaf: DEBUG
    org.springframework.security: DEBUG
