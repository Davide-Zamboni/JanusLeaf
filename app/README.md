# ğŸƒ JanusLeaf App

> Kotlin Multiplatform mobile application for JanusLeaf mood-tracking journal

A modern journaling app with a shared KMP module for data/domain/backend integration, a Compose-based Android UI, and a SwiftUI iOS UI.

---

## ğŸ—ï¸ Architecture

The app follows **Clean Architecture** principles. Shared domain/data lives in `:shared`, Android UI lives in `:composeApp`, and the iOS UI lives in `iosApp` (SwiftUI) while consuming the shared framework.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION LAYER                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Android UI        â”‚   â”‚ iOS UI               â”‚        â”‚
â”‚  â”‚ (Compose)         â”‚   â”‚ (SwiftUI)            â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      DOMAIN LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚   Models    â”‚   â”‚ Repository  â”‚                          â”‚
â”‚  â”‚             â”‚   â”‚ Interfaces  â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       DATA LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Remote API â”‚   â”‚ Repository  â”‚   â”‚   Secure    â”‚       â”‚
â”‚  â”‚   (Ktor)    â”‚   â”‚    Impl     â”‚   â”‚   Storage   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Tech Stack

| Technology | Purpose |
|------------|---------|
| **Compose Multiplatform** | Android UI |
| **Ktor Client** | HTTP networking |
| **Kotlinx Serialization** | JSON parsing |
| **Koin** | Dependency injection |
| **Kotlinx Coroutines** | Async operations |
| **Kotlinx DateTime** | Date/time handling |
| **Napier** | Multiplatform logging |

---

## ğŸ“ Project Structure

```
app/
â”œâ”€â”€ composeApp/                  # Android UI (Compose)
â”‚   â””â”€â”€ src/main/
â”œâ”€â”€ shared/                      # KMP shared module (domain + data + backend)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ commonMain/
â”‚       â”œâ”€â”€ androidMain/
â”‚       â””â”€â”€ iosMain/
â”œâ”€â”€ iosApp/                      # iOS SwiftUI Xcode project
â””â”€â”€ gradle/
```

---

## ğŸš€ Getting Started

### Prerequisites

- **JDK 17+**
- **Android Studio Hedgehog or later** (with KMP plugin)
- **Xcode 15+** (for iOS)

### Running the Backend

The app requires the JanusLeaf backend to be running:

```bash
cd ../backend
./scripts/start-db.sh
./gradlew bootRun
```

### Running on Android

```bash
# From the app directory
./gradlew :composeApp:installDebug

# Or use the helper script
./scripts/run-android.sh

# Or open in Android Studio and run
```

### Running on iOS

#### 1. Build the iOS shared framework

The iOS app consumes the KMP shared framework generated by Gradle:

```bash
./gradlew :shared:embedAndSignAppleFrameworkForXcode
```

Or build + launch directly from the CLI (one-shot):

```bash
xcodebuild -project iosApp/iosApp.xcodeproj -scheme iosApp -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.2' -derivedDataPath /tmp/janusleaf-ios build
xcrun simctl install booted /tmp/janusleaf-ios/Build/Products/Debug-iphonesimulator/JanusLeaf.app
xcrun simctl launch booted com.janusleaf.app
```

Or use the helper script:

```bash
./scripts/run-ios.sh
```

#### 2. Open in Xcode

Open `iosApp/iosApp.xcodeproj` in Xcode

#### 3. Build and Run

- Select your target (Simulator or Physical Device)
- **Clean Build Folder** (Product â†’ Clean Build Folder) if you changed the Gradle build
- Build and Run

---

## ğŸ¤– Agent Launch Notes (Android + iOS)

These steps are written for future AI agents (Codex, Claude CLI, Copilot, Cursor) to reliably launch the apps.

### Android (Compose UI)

1. Ensure SDK is configured:
```bash
cd app
cat local.properties
```
Expected:
```
sdk.dir=/Users/marhan/Library/Android/sdk
```

2. Start an emulator (example):
```bash
emulator -list-avds
emulator -avd Pixel_9_Pro
```

3. Build + install:
```bash
./gradlew :composeApp:installDebug
```

4. Launch the app:
```bash
adb shell am start -n com.janusleaf.app/.MainActivity
```

### iOS (SwiftUI + KMP shared)

1. Build the shared framework:
```bash
cd app
./gradlew :shared:embedAndSignAppleFrameworkForXcode
```

2. Launch in Xcode (recommended):
```bash
open iosApp/iosApp.xcodeproj
```

3. Optional CLI launch (simulator):
```bash
xcrun simctl list devices
xcodebuild -project iosApp/iosApp.xcodeproj -scheme iosApp -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 15' build
```

---

## ğŸ¨ Design System

The app features a custom design system inspired by **2026 design trends**:

### Color Palette

| Color | Hex | Usage |
|-------|-----|-------|
| Leaf Green | `#1A2F23` | Primary brand color |
| Sage Green | `#6B8F71` | Accent & highlights |
| Sunrise Gold | `#FFB74D` | Positive mood indicator |
| Dusk Purple | `#9575CD` | Secondary accent |

### Typography

- **Display**: Light weight for hero text
- **Headlines**: SemiBold for page titles
- **Body**: Regular weight for content

### Components

- **JanusTextField**: Custom text field with animated focus states
- **JanusPrimaryButton**: Gradient button with press animation
- **AnimatedBackground**: Flowing organic shapes

---

## ğŸ” Security

### Token Storage

- **Android**: EncryptedSharedPreferences with Android Keystore
- **iOS**: Keychain with hardware encryption

### Authentication Flow

```
1. Login/Register â†’ Store tokens securely
2. API Calls â†’ Auto-inject access token
3. Token Expired â†’ Auto-refresh with refresh token
4. Refresh Failed â†’ Redirect to login
```

---

## ğŸ“± Screens

### Authentication (Implemented âœ…)
- Login with email/password
- Register with email/username/password
- Form validation with animated errors
- Secure token management

### Home (Placeholder)
- Welcome screen after login
- Logout functionality

### Coming Soon
- Journal entry list
- Create/edit notes
- AI mood analysis
- Statistics & trends
- Profile management

---

## ğŸ”§ Configuration

### Environment Setup (Development vs Production)

The app supports **build-time environment configuration** via Gradle flags:

#### Production Build

```bash
# Android
./gradlew :composeApp:assembleDebug -PuseProduction=true
./gradlew :composeApp:assembleRelease -PuseProduction=true

# iOS - Build shared framework (Xcode will pick the correct target)
./gradlew :shared:embedAndSignAppleFrameworkForXcode -PuseProduction=true
```

#### Development Build (local backend)

```bash
# Android (default - no flag needed)
./gradlew :composeApp:assembleDebug

# iOS
./gradlew :shared:embedAndSignAppleFrameworkForXcode
```

### API Base URL Configuration

Update your production servers in `shared/src/commonMain/kotlin/com/janusleaf/app/data/remote/ServerAvailabilityManager.kt` and local dev URLs in:
- `shared/src/androidMain/kotlin/com/janusleaf/app/data/remote/ApiConfig.android.kt`
- `shared/src/iosMain/kotlin/com/janusleaf/app/data/remote/ApiConfig.ios.kt`

Production servers are checked in order for availability:
```kotlin
private val PRODUCTION_SERVERS = listOf(
    ServerConfig("http://80.225.83.90:8080"),
    ServerConfig("http://158.180.228.188:8080"),
    ServerConfig("https://janusleaf.onrender.com")
)
```

### How It Works

| Flag | Environment | Backend URL |
|------|-------------|-------------|
| `-PuseProduction=true` | Production | First available server in `PRODUCTION_SERVERS` |
| *(default)* | Development | localhost / 10.0.2.2 |

The build will output which environment was configured:
```
ğŸ”§ BuildConfig generated: USE_PRODUCTION = true
```

### âš ï¸ Notes for Production

- **HTTPS Required**: Render uses HTTPS by default âœ“
- **Cold Starts**: Free Render instances spin down after inactivity (~30s wake-up time)
- **No Trailing Slash**: Ensure your URL doesn't end with `/`

---

## ğŸ“„ License

MIT License - Part of the JanusLeaf project
